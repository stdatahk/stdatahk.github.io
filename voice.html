<html>
<head>
<title>TTS</title>
<script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.0/jquery.min.js'></script>
</head>
<body>

<script language="JavaScript">
function detectMsg() {
	var txt = document.getElementById('text');
	var msg = txt.value;

	if(msg.indexOf('智科數') >= 0 || msg.indexOf('智能科技數據') >= 0) {
		msg = '歡迎返嚟呀, 請問有咩可以幫到你呢?';
	}
	else if(msg.indexOf('燈') >= 0) {
		msg = '好呀主人，我依傢就去開燈，唔知夠唔夠光呢?';
	}
	else if(msg.indexOf('冷氣') >= 0) {
		msg = '好呀主人，我依傢就去開冷氣，請問夠唔夠凍呢?';
	}
	else if(msg.indexOf('風扇') >= 0) {
		msg = '好呀主人，我依傢就去開風扇，請問會唔會太涼呢?';
	}
	else if(msg.indexOf('頂') >= 0) {
		msg = '唔該唔好講粗口啦';
	}
	txt.value = msg;
}
</script>

<p>
    <label>文字
        <input type="text" id="text" value="你好呀我係軒仔呀123" onchange="detectMsg();"  onleave="detectMsg();"></input>
    </label>
</p>
<p>
    <label>音量
        <input type="number" id="volume" value="1"></input>
    </label>
</p>
<p>
    <label>速度
        <input type="number" id="rate" value="1"></input>
    </label>
</p>
<p>
    <label>聲調
        <input type="number" id="pitch" value="1"></input>
    </label>
</p>
<p>
    <label>語言
        <select id="voice"></select>
    </label>
</p>
<p>
    <button type="button">發聲</button>
</p>

<script language='JavaScript'>
<!--
var message = new SpeechSynthesisUtterance($("#text").val());
var voices = speechSynthesis.getVoices();

$("input").on("change", function () {
    console.log($(this).attr("id"), $(this).val());
    message[$(this).attr("id")] = $(this).val();
});

$("select").on("change", function () {
    message.voice = voices[$(this).val()];
});

$("button").on("click", function () {
    message.voice = voices[$("select").val()];
    speechSynthesis.speak(message);
});

// Hack around voices bug
var interval = setInterval(function () {
    voices = speechSynthesis.getVoices();
    if (voices.length) clearInterval(interval); else return;

    for (var i = 0; i < voices.length; i++) {
		//detect cantonese by unicode
		$("select").append("<option value=\"" + i + "\">" + voices[i].name + "</option>");
    }
}, 10);

//-->
</script>

</body>
</html>