<html>
<head>
<title>FRS | Admin| To-Do</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>
<body>


<h2 style="font-family:Arial;">FRS TO-DO LIST:</h2>

<b>篩選條件：</b>
BY 
<select id="sel1" onchange='filterSel1();'>
	<option>優先程度</option>
	<option>Must Have</option>
	<option>Nice To Have</option>
	<option>Suggestion</option>
	<option>Urgent</option>
	<option>BUG</option>
	<option>Critical</option>
	<option>TBC</option>
	<option>TBD</option>
	<option>Show ALL</option>
</select> 
OR 
<select id="sel2" onchange='filterSel2();'>
	<option>發起人</option>
	<option>Andy</option>
	<option>Howard</option>
	<option>Show ALL</option>
</select>

<input type=hidden id='hTotal' value=''>

<div id="theDiv" style="text-align:right;">
<input style="width:80px;height:30px;" type=button value="REFRESH" onclick="location.reload();">
&nbsp;&nbsp;
<input style="width:70px;height:30px;" type=button value="ADD" onclick="location.href='todo_add.htm';">
&nbsp;&nbsp;
<input style="width:70px;height:30px;" type=button value="EDIT" onclick="location.href='todo_edit.htm';">
&nbsp;&nbsp;
<input style="width:70px;height:30px;" type=button value="DELETE"onclick="location.href='todo_del.htm';">
</div>
<br>


<table id='tbl' width='100%' border=1 cellpadding=2 cellspacing=0 style="font-family:Arial;">
<!-- table header -->
<tr>
<td width=150 style="font-weight:bold;font-size:20px;">
	<nobr>功能／項目</nobr>
</td>
<td style="font-weight:bold;font-size:20px;">
	<nobr>關於／詳情</nobr>
</td>
<td style="font-weight:bold;font-size:20px;">
	<nobr>優先</nobr>
</td>
<td style="font-weight:bold;font-size:20px;">
	<nobr>發起人/日期</nobr>
</td>
<td style="font-weight:bold;font-size:20px;">
	<nobr>狀態</nobr>
</td>
</tr>
<!-- end table header -->
<tr id='tr0'>
<td>Loading...</td>
<td>Loading...</td>
<td>Loading...</td>
<td>Loading...</td>
<td>Loading...</td>
</tr>
</table>


<script language="JavaScript">
<!--
var gasId = "AKfycbwHLSiDw3M30YfAjThHfy0a7BEbzcbho_YPpPXAFAVFD5pWnvg_";
var gssId = "1-aFZEOwemMh3ob_ZDqlpWd360aN6MdLraVFPw2V1RS0"; //for todo page
var gasUrl = "https://script.google.com/macros/s/"+ gasId +"/exec";

$(document).ready(function(){
	$.ajax({
	  url: gasUrl,
	  cache: false,
	  type: "GET",
	  data: {
		func: 'GETDATA', 
		id: gssId,  
		key: 12345678
	  },
	  dataType: "html",
	  success: function(html){
	  
		var ary = null;
		var rst = "";
		html = "ary="+html+";";
	    eval(html);

		document.getElementById('hTotal').value = ary.length;

		if(ary.length > 0) {
			$("#tr0").remove();
			$("#tbl").prepend("共 "+ ary.length +" 筆資料");
		}

		for(var i=0; i<ary.length; i++) {
			ary[i][1] = ary[i][1].trim(); 
			if(ary[i][1].charAt(0)=='{' && ary[i][1].charAt(ary[i][1].length-1)=='}')
			{	//JSON format
				var obj = JSON.parse(ary[i][1]);
				var ta = obj.t.trim().split(" ");
				var tt = ta[1]+ta[2];
				
				rst += "<tr id='tr"+i+"'>";
				rst += "<td>"+ ary[i][0] +"</td>";
				rst += "<td>"+ obj.dtl +"</td>";
				rst += "<td><nobr>"+ obj.prty +"<nobr></td>";
				rst += "<td><nobr>"+ obj.n +" on "+ tt +"<nobr></td>";
				rst += "<td>"+ obj.sts +"</td>";
				rst += "</tr>";
			}
			else {
				//old data, plain text
				rst += "<tr id='tr"+i+"'>";
				rst += "<td>"+ ary[i][0] +"</td>";
				rst += "<td>"+ ary[i][1] +"</td>";
				rst += "<td>"+ "(n/a)" +"</td>";
				rst += "<td>"+ "(n/a)" +"</td>";
				rst += "<td>"+ "(n/a)" +"</td>";
				rst += "</tr>";
			}
		}
		$("#tbl").append(rst);
	  }
	});
});

function filterSel1() {
	var theSel = document.getElementById('sel1');
	var idx = $("#sel1 option:selected").text().trim();
	if(idx=='Show ALL') location.reload();

	//remove unwanted tr items
	var rst = '';
	var total = document.getElementById('hTotal').value;
	for(var i=0; i < total; i++) {
		var theTr = ('tr'+i);
		if(!document.getElementById(theTr)) continue;
		var txt = document.getElementById(theTr).childNodes[2].innerText; //3rd-col
		if(txt != idx)
			rst += ('_#tr'+i);
	}
	var a = rst.substring(1).split('_');
	for(var i=0; i < a.length; i++) {
		$(a[i]).remove();
	}
}

function filterSel2() {
	var theSel = document.getElementById('sel2');
	var idx = $("#sel2 option:selected").text().trim().toLowerCase();
	if(idx=='show all') location.reload();

	//remove unwanted tr items
	var rst = '';
	var total = document.getElementById('hTotal').value;
	for(var i=0; i < total; i++) {
		var theTr = ('tr'+i);
		if(!document.getElementById(theTr)) continue;
		var txt = document.getElementById(theTr).childNodes[3].innerText; //4th-col
		txt = txt.split(' on ')[0].trim().toLowerCase();
		if(txt != idx)
			rst += ('_#tr'+i);
	}
	var a = rst.substring(1).split('_');
	for(var i=0; i < a.length; i++) {
		$(a[i]).remove();
	}
}
//-->
</script>



</body>
</html>
