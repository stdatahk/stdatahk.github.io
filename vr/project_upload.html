
<html>
<head>
<title>VR360 | Project | Upload</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>
<body>

<h2 style="font-family:Arial;">上載VR360圖片至雲端資料夾：</h2>

<div id="theDiv" style="text-align:right;">
<input id='btnBack' style="width:70px;height:30px;" type=button value=" 返回 " onclick="self.close();">
</div>
<br>

<form id="form">
  <input name="file" id="uploadfile" type="file" />
  <input id="submit" type="submit" onclick="this.value='上載圖片中...';" />
</form>

<script>
function doDisplay(obj) {
	$('#submit').value = "圖片上載成功";
	var str = "檔案上傳成功, 按返回回到新增項目頁面. info: "+ JSON.stringify(obj);
	var node = document.createTextNode(str);
	$('body').append(node);
}

  const form = document.getElementById("form");
  form.addEventListener("submit", (e) => {
    e.preventDefault();
    const file = form.file.files[0];
    const fr = new FileReader();
    fr.readAsArrayBuffer(file);
    fr.onload = (f) => {
      const url = "https://script.google.com/macros/s/AKfycbzJ7mejMgiiup62LF4aAvqLNk06p486us8f_lrwoOHZ-NVCO779dLqWUy5CFL_orSTg/exec";

      const qs = new URLSearchParams({
        filename: file.name,
        mimeType: file.type,
      	func: location.href.substring(location.href.indexOf('?')+1) ,
      });
      fetch(`${url}?${qs}`, {
        method: "POST",
        body: JSON.stringify([...new Int8Array(f.target.result)]),
      })
        .then((res) => res.json())
        .then(doDisplay) //console.log
        .catch(console.log);
    };
  });
</script>

</body>
</html>
